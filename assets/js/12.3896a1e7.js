(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{380:function(s,e,n){"use strict";n.r(e);var a=n(40),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"postgressql-操作指引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#postgressql-操作指引"}},[s._v("#")]),s._v(" PostgresSQL 操作指引")]),s._v(" "),n("h2",{attrs:{id:"安裝"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安裝"}},[s._v("#")]),s._v(" 安裝")]),s._v(" "),n("p",[s._v("安裝作業。")]),s._v(" "),n("h2",{attrs:{id:"設定"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#設定"}},[s._v("#")]),s._v(" 設定")]),s._v(" "),n("p",[s._v("設定作業。")]),s._v(" "),n("h2",{attrs:{id:"驗證"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#驗證"}},[s._v("#")]),s._v(" 驗證")]),s._v(" "),n("p",[s._v("驗證安裝與設定作業，均正確完成。")]),s._v(" "),n("h2",{attrs:{id:"異常排除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#異常排除"}},[s._v("#")]),s._v(" 異常排除")]),s._v(" "),n("p",[s._v("當 App 發生異常，應如何診斷問題來源、排除異常及回復正常作業的常見案例。")]),s._v(" "),n("h3",{attrs:{id:"清除-postgressql-volume-內的資料庫"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#清除-postgressql-volume-內的資料庫"}},[s._v("#")]),s._v(" 清除 PostgresSQL Volume 內的資料庫")]),s._v(" "),n("ol",[n("li",[s._v("確認 Volume Name （postgres_data）。")])]),s._v(" "),n("p",[s._v("【指令】：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker volume ls\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("【操作】：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker volume ls --filter "name=ex2020-001"\nDRIVER              VOLUME NAME\nlocal               ex2020-001_postgres_data\nlocal               ex2020-001_pycharm_helpers_PY-201.8538.36\nlocal               ex2020-001_pycharm_skeletons_1294759262\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("清空 PostgresSQl Volume 。")])]),s._v(" "),n("p",[s._v("【指令】：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker volume rm <VOLUME>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("【操作】：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ docker volume rm ex2020-001_postgres_data\nError response from daemon: remove ex2020-001_postgres_data: volume is in use - [b2499e018fa5fdcc6093c5665302d50a47f7d752ef015c2c4f0c119a3c422a7d]\n\n$ docker volume rm ex2020-001_postgres_data -f\nError response from daemon: remove ex2020-001_postgres_data: volume is in use - [b2499e018fa5fdcc6093c5665302d50a47f7d752ef015c2c4f0c119a3c422a7d]\n\n$ docker-compose ps\n      Name                    Command               State           Ports\n----------------------------------------------------------------------------------\nex2020-001_db_1    docker-entrypoint.sh postgres    Up      5432/tcp\nex2020-001_web_1   python /code/manage.py run ...   Up      0.0.0.0:8000->8000/tcp\n\n$ docker-compose down\nStopping ex2020-001_web_1 ... done\nStopping ex2020-001_db_1  ... done\nRemoving ex2020-001_web_1 ... done\nRemoving ex2020-001_db_1  ... done\nRemoving network ex2020-001_default\n\n$ docker volume rm ex2020-001_postgres_data\nex2020-001_postgres_data\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"建立新-model-卻無法執行-migrate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建立新-model-卻無法執行-migrate"}},[s._v("#")]),s._v(" 建立新 Model ，卻無法執行 migrate")]),s._v(" "),n("p",[s._v("使用 startapp 建立新 app ，並於此 app 新建 Model ，可以順利完成 makemigration ，卻無法完成 migrate 。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ docker-compose exec web python manage.py makemigrations users\nMigrations for \'users\':\n  users/migrations/0001_initial.py\n    - Create model CustomUser\n\n$ docker-compose exec web python manage.py migrate\nTraceback (most recent call last):\n  File "manage.py", line 21, in <module>\n    main()\n  File "manage.py", line 17, in main\n    execute_from_command_line(sys.argv)\n  File "/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py", line 401, in execute_from_command_line\n    utility.execute()\n  File "/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py", line 395, in execute\n    self.fetch_command(subcommand).run_from_argv(self.argv)\n  File "/usr/local/lib/python3.8/site-packages/django/core/management/base.py", line 328, in run_from_argv\n    self.execute(*args, **cmd_options)\n  File "/usr/local/lib/python3.8/site-packages/django/core/management/base.py", line 369, in execute\n    output = self.handle(*args, **options)\n  File "/usr/local/lib/python3.8/site-packages/django/core/management/base.py", line 83, in wrapped\n    res = handle_func(*args, **kwargs)\n  File "/usr/local/lib/python3.8/site-packages/django/core/management/commands/migrate.py", line 89, in handle\n    executor.loader.check_consistent_history(connection)\n  File "/usr/local/lib/python3.8/site-packages/django/db/migrations/loader.py", line 295, in check_consistent_history\n    raise InconsistentMigrationHistory(\ndjango.db.migrations.exceptions.InconsistentMigrationHistory: Migration admin.0001_initial is applied before its dependency users.0001_initial on data\nbase \'default\'.\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("p",[s._v("上述問題可先清空 PostgreSQL Volume 後，再重建。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 確認 docker-compose 已重新啟動\n$ docker-compose up -d --build\n⋯⋯\n$ docker-compose ps\n      Name                    Command               State           Ports\n----------------------------------------------------------------------------------\nex2020-001_db_1    docker-entrypoint.sh postgres    Up      5432/tcp\nex2020-001_web_1   python /code/manage.py run ...   Up      0.0.0.0:8000->8000/tcp\n\n# 要求 PostgreSQL 重建「資料庫」\n$ docker-compose exec web python manage.py migrate\nOperations to perform:\n  Apply all migrations: admin, auth, contenttypes, sessions, users\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying contenttypes.0002_remove_content_type_name... OK\n  Applying auth.0001_initial... OK\n  Applying auth.0002_alter_permission_name_max_length... OK\n  Applying auth.0003_alter_user_email_max_length... OK\n  Applying auth.0004_alter_user_username_opts... OK\n  Applying auth.0005_alter_user_last_login_null... OK\n  Applying auth.0006_require_contenttypes_0002... OK\n  Applying auth.0007_alter_validators_add_error_messages... OK\n  Applying auth.0008_alter_user_username_max_length... OK\n  Applying auth.0009_alter_user_last_name_max_length... OK\n  Applying auth.0010_alter_group_name_max_length... OK\n  Applying auth.0011_update_proxy_permissions... OK\n  Applying users.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying admin.0002_logentry_remove_auto_add... OK\n  Applying admin.0003_logentry_add_action_flag_choices... OK\n  Applying sessions.0001_initial... OK\n\n$ docker-compose exec web python manage.py createsuperuser\nUsername: admin\nEmail address: alanjui.1960@gmail.com\nPassword:\nPassword (again):\nSuperuser created successfully.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);