<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PostgresSQL 操作指引 | Manjaro KDE 開發環境建置指引</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="如何在 Manjaro KDE 電腦建置開發環境">
    
    <link rel="preload" href="/python-with-vuepress/assets/css/0.styles.4d8e33c0.css" as="style"><link rel="preload" href="/python-with-vuepress/assets/js/app.070c92b2.js" as="script"><link rel="preload" href="/python-with-vuepress/assets/js/2.b40a21d6.js" as="script"><link rel="preload" href="/python-with-vuepress/assets/js/12.3896a1e7.js" as="script"><link rel="prefetch" href="/python-with-vuepress/assets/js/10.f31b7c95.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/11.610cce76.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/13.6c154b82.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/14.8774a74c.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/3.76bcbcb3.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/4.58205e72.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/5.99755b36.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/6.fa98b136.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/7.1a299492.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/8.9851b8db.js"><link rel="prefetch" href="/python-with-vuepress/assets/js/9.4b66b1fe.js">
    <link rel="stylesheet" href="/python-with-vuepress/assets/css/0.styles.4d8e33c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/python-with-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Manjaro KDE 開發環境建置指引</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/python-with-vuepress/" class="nav-link">
  專案文件
</a></div><div class="nav-item"><a href="/python-with-vuepress/D01/" class="nav-link">
  作業流程
</a></div><div class="nav-item"><a href="/python-with-vuepress/D02/" class="nav-link">
  應用工具
</a></div><div class="nav-item"><a href="/python-with-vuepress/D03/" class="nav-link">
  專業知識
</a></div><div class="nav-item"><a href="/python-with-vuepress/D04/" class="nav-link">
  教育訓練
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/python-with-vuepress/" class="nav-link">
  專案文件
</a></div><div class="nav-item"><a href="/python-with-vuepress/D01/" class="nav-link">
  作業流程
</a></div><div class="nav-item"><a href="/python-with-vuepress/D02/" class="nav-link">
  應用工具
</a></div><div class="nav-item"><a href="/python-with-vuepress/D03/" class="nav-link">
  專業知識
</a></div><div class="nav-item"><a href="/python-with-vuepress/D04/" class="nav-link">
  教育訓練
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/python-with-vuepress/" aria-current="page" class="sidebar-link">專案指引</a></li><li><a href="/python-with-vuepress/D01/" class="sidebar-link">作業流程</a></li><li><a href="/python-with-vuepress/D02/" class="sidebar-link">應用工具</a></li><li><a href="/python-with-vuepress/D03/" class="sidebar-link">專案知識</a></li><li><a href="/python-with-vuepress/D04/" class="sidebar-link">教育訓練</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="postgressql-操作指引"><a href="#postgressql-操作指引" class="header-anchor">#</a> PostgresSQL 操作指引</h1> <h2 id="安裝"><a href="#安裝" class="header-anchor">#</a> 安裝</h2> <p>安裝作業。</p> <h2 id="設定"><a href="#設定" class="header-anchor">#</a> 設定</h2> <p>設定作業。</p> <h2 id="驗證"><a href="#驗證" class="header-anchor">#</a> 驗證</h2> <p>驗證安裝與設定作業，均正確完成。</p> <h2 id="異常排除"><a href="#異常排除" class="header-anchor">#</a> 異常排除</h2> <p>當 App 發生異常，應如何診斷問題來源、排除異常及回復正常作業的常見案例。</p> <h3 id="清除-postgressql-volume-內的資料庫"><a href="#清除-postgressql-volume-內的資料庫" class="header-anchor">#</a> 清除 PostgresSQL Volume 內的資料庫</h3> <ol><li>確認 Volume Name （postgres_data）。</li></ol> <p>【指令】：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker volume ls
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>【操作】：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker volume ls --filter &quot;name=ex2020-001&quot;
DRIVER              VOLUME NAME
local               ex2020-001_postgres_data
local               ex2020-001_pycharm_helpers_PY-201.8538.36
local               ex2020-001_pycharm_skeletons_1294759262
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>清空 PostgresSQl Volume 。</li></ol> <p>【指令】：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker volume rm &lt;VOLUME&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>【操作】：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker volume rm ex2020-001_postgres_data
Error response from daemon: remove ex2020-001_postgres_data: volume is in use - [b2499e018fa5fdcc6093c5665302d50a47f7d752ef015c2c4f0c119a3c422a7d]

$ docker volume rm ex2020-001_postgres_data -f
Error response from daemon: remove ex2020-001_postgres_data: volume is in use - [b2499e018fa5fdcc6093c5665302d50a47f7d752ef015c2c4f0c119a3c422a7d]

$ docker-compose ps
      Name                    Command               State           Ports
----------------------------------------------------------------------------------
ex2020-001_db_1    docker-entrypoint.sh postgres    Up      5432/tcp
ex2020-001_web_1   python /code/manage.py run ...   Up      0.0.0.0:8000-&gt;8000/tcp

$ docker-compose down
Stopping ex2020-001_web_1 ... done
Stopping ex2020-001_db_1  ... done
Removing ex2020-001_web_1 ... done
Removing ex2020-001_db_1  ... done
Removing network ex2020-001_default

$ docker volume rm ex2020-001_postgres_data
ex2020-001_postgres_data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="建立新-model-卻無法執行-migrate"><a href="#建立新-model-卻無法執行-migrate" class="header-anchor">#</a> 建立新 Model ，卻無法執行 migrate</h3> <p>使用 startapp 建立新 app ，並於此 app 新建 Model ，可以順利完成 makemigration ，卻無法完成 migrate 。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker-compose exec web python manage.py makemigrations users
Migrations for 'users':
  users/migrations/0001_initial.py
    - Create model CustomUser

$ docker-compose exec web python manage.py migrate
Traceback (most recent call last):
  File &quot;manage.py&quot;, line 21, in &lt;module&gt;
    main()
  File &quot;manage.py&quot;, line 17, in main
    execute_from_command_line(sys.argv)
  File &quot;/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py&quot;, line 401, in execute_from_command_line
    utility.execute()
  File &quot;/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py&quot;, line 395, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File &quot;/usr/local/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 328, in run_from_argv
    self.execute(*args, **cmd_options)
  File &quot;/usr/local/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 369, in execute
    output = self.handle(*args, **options)
  File &quot;/usr/local/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 83, in wrapped
    res = handle_func(*args, **kwargs)
  File &quot;/usr/local/lib/python3.8/site-packages/django/core/management/commands/migrate.py&quot;, line 89, in handle
    executor.loader.check_consistent_history(connection)
  File &quot;/usr/local/lib/python3.8/site-packages/django/db/migrations/loader.py&quot;, line 295, in check_consistent_history
    raise InconsistentMigrationHistory(
django.db.migrations.exceptions.InconsistentMigrationHistory: Migration admin.0001_initial is applied before its dependency users.0001_initial on data
base 'default'.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>上述問題可先清空 PostgreSQL Volume 後，再重建。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 確認 docker-compose 已重新啟動
$ docker-compose up -d --build
⋯⋯
$ docker-compose ps
      Name                    Command               State           Ports
----------------------------------------------------------------------------------
ex2020-001_db_1    docker-entrypoint.sh postgres    Up      5432/tcp
ex2020-001_web_1   python /code/manage.py run ...   Up      0.0.0.0:8000-&gt;8000/tcp

# 要求 PostgreSQL 重建「資料庫」
$ docker-compose exec web python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, sessions, users
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0001_initial... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying users.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying sessions.0001_initial... OK

$ docker-compose exec web python manage.py createsuperuser
Username: admin
Email address: alanjui.1960@gmail.com
Password:
Password (again):
Superuser created successfully.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/python-with-vuepress/assets/js/app.070c92b2.js" defer></script><script src="/python-with-vuepress/assets/js/2.b40a21d6.js" defer></script><script src="/python-with-vuepress/assets/js/12.3896a1e7.js" defer></script>
  </body>
</html>
